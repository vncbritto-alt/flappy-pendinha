<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flappy Pendinha</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#70c5ce;
  font-family:Arial,Helvetica,sans-serif;
}

#gameContainer{
  position:relative;
  max-width:520px;
  margin:20px auto;
}

canvas{
  width:100%;
  height:auto;
  background:#70c5ce;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,.25);
  display:block;
}

#fullscreenBtn{
  position:absolute;
  top:10px;
  right:10px;
  z-index:10;
  background:rgba(0,0,0,.6);
  color:white;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
  font-size:18px;
}
</style>
</head>

<body>

<div id="gameContainer">
  <button id="fullscreenBtn">⛶</button>
  <canvas id="game"></canvas>
</div>

<script>
/* ================= BASE / RESIZE ================= */
const BASE_WIDTH = 360;
const BASE_HEIGHT = 520;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  const scale = Math.min(
    window.innerWidth / BASE_WIDTH,
    window.innerHeight / BASE_HEIGHT
  );
  canvas.width = BASE_WIDTH * scale;
  canvas.height = BASE_HEIGHT * scale;
  ctx.setTransform(scale,0,0,scale,0,0);
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);
document.addEventListener("fullscreenchange", resizeCanvas);

/* FULLSCREEN */
document.getElementById("fullscreenBtn").onclick = ()=>{
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  } else {
    document.exitFullscreen();
  }
};

/* ================= CONFIG ================= */
const CONFIG = {
  gravity: 0.35,
  jump: -8,
  gap: 190,
  baseSpeed: 2.2,
  pipeWidth: 46,
  spacing: 220,
  pool: 7,
  pointsPerPhase: 20,
  maxPhases: 30
};

/* ================= STATE ================= */
let bird, pipes, running, score, phase, speed;
let gameState = "menu"; // menu | playing
let selectedSkin = localStorage.getItem("skin") || "bird";

/* ================= SKINS ================= */
const skins = ["bird","bat","cat","dog","pig"];

/* ================= RESET ================= */
function resetGame(){
  bird = { x:90, y:BASE_HEIGHT/2, r:18, vy:0 };
  pipes = [];
  score = 0;
  phase = 1;
  speed = CONFIG.baseSpeed;
  running = false;

  let x = BASE_WIDTH;
  for(let i=0;i<CONFIG.pool;i++){
    pipes.push(createPipe(x));
    x += CONFIG.spacing;
  }
}

function createPipe(x){
  const top = Math.random()*(BASE_HEIGHT/2 - 80) + 40;
  return { x, top, bottom: top + CONFIG.gap, passed:false };
}

/* ================= INPUT ================= */
canvas.addEventListener("click",(e)=>{
  if(gameState==="menu"){
    handleMenuClick(e);
  } else {
    running = true;
    bird.vy = CONFIG.jump;
  }
});

/* ================= MENU ================= */
function handleMenuClick(e){
  const rect = canvas.getBoundingClientRect();
  const mx = (e.clientX - rect.left) * (BASE_WIDTH / canvas.width);
  const my = (e.clientY - rect.top) * (BASE_HEIGHT / canvas.height);

  skins.forEach((skin,i)=>{
    const x = 60 + i*60;
    const y = 260;
    if(mx > x-20 && mx < x+20 && my > y-20 && my < y+20){
      selectedSkin = skin;
      localStorage.setItem("skin", skin);
    }
  });

  // botão jogar
  if(mx > 120 && mx < 240 && my > 340 && my < 380){
    gameState = "playing";
    resetGame();
  }
}

/* ================= DRAW SKINS ================= */
function drawBird(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.fillStyle="#ffeb3b";
  ctx.beginPath(); ctx.ellipse(0,0,20,16,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="#ff9800";
  ctx.beginPath(); ctx.moveTo(18,-2); ctx.lineTo(30,0); ctx.lineTo(18,6); ctx.fill();
  ctx.fillStyle="#000";
  ctx.beginPath(); ctx.arc(6,-5,3,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

function drawBat(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.fillStyle="#444";
  ctx.beginPath(); ctx.arc(0,0,16,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle="#222";
  ctx.beginPath(); ctx.moveTo(-20,0); ctx.lineTo(0,-10); ctx.lineTo(20,0); ctx.stroke();
  ctx.restore();
}

function drawCat(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.fillStyle="#ffcc99";
  ctx.beginPath(); ctx.arc(0,0,16,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.moveTo(-10,-14); ctx.lineTo(-4,-22); ctx.lineTo(0,-14); ctx.fill();
  ctx.beginPath(); ctx.moveTo(10,-14); ctx.lineTo(4,-22); ctx.lineTo(0,-14); ctx.fill();
  ctx.restore();
}

function drawDog(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.fillStyle="#c68642";
  ctx.beginPath(); ctx.arc(0,0,16,0,Math.PI*2); ctx.fill();
  ctx.fillRect(-18,-4,6,14);
  ctx.fillRect(12,-4,6,14);
  ctx.restore();
}

function drawPig(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.fillStyle="#ffb6c1";
  ctx.beginPath(); ctx.arc(0,0,16,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="#ff8da1";
  ctx.beginPath(); ctx.ellipse(0,4,6,4,0,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

function drawPlayer(){
  const r = bird.vy/10;
  if(selectedSkin==="bird") drawBird(bird.x,bird.y,r);
  if(selectedSkin==="bat") drawBat(bird.x,bird.y,r);
  if(selectedSkin==="cat") drawCat(bird.x,bird.y,r);
  if(selectedSkin==="dog") drawDog(bird.x,bird.y,r);
  if(selectedSkin==="pig") drawPig(bird.x,bird.y,r);
}

/* ================= UPDATE ================= */
function update(){
  if(!running) return;

  bird.vy += CONFIG.gravity;
  bird.y += bird.vy;

  for(const p of pipes){
    p.x -= speed;
    if(p.x < -CONFIG.pipeWidth){
      const lastX = pipes[pipes.length-1].x;
      pipes.shift();
      pipes.push(createPipe(lastX + CONFIG.spacing));
    }
  }

  if(bird.y < 0 || bird.y > BASE_HEIGHT){
    gameState = "menu";
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,BASE_WIDTH,BASE_HEIGHT);

  if(gameState==="menu"){
    ctx.fillStyle="#fff";
    ctx.font="24px Arial";
    ctx.fillText("Escolha seu personagem",40,120);

    skins.forEach((skin,i)=>{
      const x = 60 + i*60;
      const y = 260;
      ctx.strokeStyle = skin===selectedSkin ? "#00f" : "#000";
      ctx.strokeRect(x-22,y-22,44,44);
      bird={x,y};
      selectedSkin=skin;
      drawPlayer();
    });

    selectedSkin = localStorage.getItem("skin") || "bird";

    ctx.fillStyle="#000";
    ctx.fillRect(120,340,120,40);
    ctx.fillStyle="#fff";
    ctx.fillText("JOGAR",150,368);
    return;
  }

  ctx.fillStyle="#3fa34b";
  for(const p of pipes){
    ctx.fillRect(p.x,0,CONFIG.pipeWidth,p.top);
    ctx.fillRect(p.x,p.bottom,CONFIG.pipeWidth,BASE_HEIGHT-p.bottom);
  }

  drawPlayer();

  // HUD
  ctx.fillStyle="#000";
  ctx.font="16px Arial";
  ctx.fillText("Score: "+score,10,20);
}

/* ================= LOOP ================= */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
