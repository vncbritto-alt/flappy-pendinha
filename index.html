<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flappy Pendinha</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#111;
  font-family:Arial,Helvetica,sans-serif;
}
#gameContainer{
  position:relative;
  max-width:520px;
  margin:20px auto;
}
canvas{
  width:100%;
  height:auto;
  border-radius:10px;
  display:block;
}
#fullscreenBtn{
  position:absolute;
  top:10px;
  right:10px;
  z-index:10;
  background:rgba(0,0,0,.6);
  color:white;
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
  font-size:18px;
}
</style>
</head>

<body>

<div id="gameContainer">
  <button id="fullscreenBtn">⛶</button>
  <canvas id="game"></canvas>
</div>

<script>
/* ===== BASE ===== */
const BASE_W=360, BASE_H=520;
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

/* RESIZE */
function resize(){
  const s=Math.min(innerWidth/BASE_W, innerHeight/BASE_H);
  canvas.width=BASE_W*s;
  canvas.height=BASE_H*s;
  ctx.setTransform(s,0,0,s,0,0);
}
resize();
addEventListener("resize",resize);
addEventListener("fullscreenchange",resize);

/* FULLSCREEN */
fullscreenBtn.onclick=()=>{
  if(!document.fullscreenElement) document.documentElement.requestFullscreen();
  else document.exitFullscreen();
};

/* ===== CONFIG ===== */
const CFG={
  gravity:0.35,
  jump:-8,
  baseSpeed:2.2,
  gap:190,
  pipeW:46,
  spacing:220,
  pool:7
};

/* ===== STATE ===== */
let bird,pipes,score,running=false;
let anim=0;
let gameState="play";

/* ===== CENÁRIOS ===== */
const scenes=[
  "#70c5ce","#ffcc80","#3f51b5",
  "#263238","#4caf50","#9c27b0"
];

/* ===== RESET ===== */
function reset(){
  bird={x:90,y:BASE_H/2,r:18,vy:0};
  pipes=[];
  score=0;
  running=false;
  let x=BASE_W;
  for(let i=0;i<CFG.pool;i++){
    pipes.push(pipe(x));
    x+=CFG.spacing;
  }
}
function pipe(x){
  const top=Math.random()*(BASE_H/2-80)+40;
  return{x,top,bottom:top+CFG.gap,passed:false};
}

/* INPUT */
canvas.onclick=()=>{
  running=true;
  bird.vy=CFG.jump;
};

/* COLLISION */
function hit(b,p){
  return b.x+b.r>p.x && b.x-b.r<p.x+CFG.pipeW &&
    (b.y-b.r<p.top || b.y+b.r>p.bottom);
}

/* DRAW PLAYER (ANIMADO) */
function drawBird(){
  ctx.save();
  ctx.translate(bird.x,bird.y);
  ctx.rotate(bird.vy/10);

  const wing=Math.sin(anim*8)*6;

  ctx.fillStyle="#ffeb3b";
  ctx.beginPath();
  ctx.ellipse(0,0,20,16,0,0,Math.PI*2);
  ctx.fill();

  ctx.save();
  ctx.rotate(wing*0.02);
  ctx.fillStyle="#fdd835";
  ctx.beginPath();
  ctx.ellipse(-6,4,8,6,0,0,Math.PI*2);
  ctx.fill();
  ctx.restore();

  ctx.fillStyle="#ff9800";
  ctx.beginPath();
  ctx.moveTo(18,-2);ctx.lineTo(30,0);ctx.lineTo(18,6);
  ctx.fill();

  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(6,-5,3,0,Math.PI*2);
  ctx.fill();

  ctx.restore();
}

/* UPDATE */
function update(){
  anim+=0.12;
  if(!running) return;

  bird.vy+=CFG.gravity;
  bird.y+=bird.vy;

  const fase=Math.floor(score/10);
  const speed=CFG.baseSpeed+fase*0.3;

  for(const p of pipes){
    p.x-=speed;
    if(!p.passed && p.x+CFG.pipeW<bird.x){
      p.passed=true;
      score++;
    }
    if(hit(bird,p)){gameOver();return;}
  }

  if(bird.y<0||bird.y>BASE_H) gameOver();

  if(pipes[0].x<-CFG.pipeW){
    const last=pipes.at(-1).x;
    pipes.shift();
    pipes.push(pipe(last+CFG.spacing));
  }
}

/* GAME OVER */
function gameOver(){
  running=false;
  if(score>=20){
    const name=prompt("Você fez "+score+" pontos! Nome:");
    if(name){
      const r=JSON.parse(localStorage.getItem("ranking")||"[]");
      r.push({name,score});
      r.sort((a,b)=>b.score-a.score);
      localStorage.setItem("ranking",JSON.stringify(r.slice(0,5)));
    }
  }
  reset();
}

/* DRAW */
function draw(){
  const fase=Math.floor(score/10);
  ctx.fillStyle=scenes[fase%scenes.length];
  ctx.fillRect(0,0,BASE_W,BASE_H);

  ctx.fillStyle="#3fa34b";
  for(const p of pipes){
    ctx.fillRect(p.x,0,CFG.pipeW,p.top);
    ctx.fillRect(p.x,p.bottom,CFG.pipeW,BASE_H-p.bottom);
  }

  drawBird();

  ctx.fillStyle="#000";
  ctx.font="16px Arial";
  ctx.fillText("Score: "+score,10,20);
}

/* LOOP */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
reset();
loop();
</script>

</body>
</html>
